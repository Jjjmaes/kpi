# 综合岗业务看板权限分析

## 当前权限配置

### 配置的权限（config/permissions.js）
- `project.view`: "all" - **可以查看所有项目**
- `project.edit`: false - 不能编辑项目
- `project.create`: true - 可以创建项目
- `project.member.manage`: true - 可以管理项目成员
- `kpi.view`: "self" - 只能查看自己的KPI
- `finance.view`: false - **不能查看财务数据**
- `customer.view`: false - 不能查看客户信息

### 实际能看到的数据

#### ✅ 应该看到的（符合权限）
1. **所有项目列表**（project.view: "all"）
2. **项目状态统计**（进行中、已完成、待开始等）
3. **交付逾期信息**（项目交付相关，非财务）
4. **自己的KPI**（kpi.view: "self"）

#### ⚠️ 可能权限过宽的数据

1. **项目金额合计**（dashboard.js 第99行允许 admin_staff 查看）
   - 问题：虽然 `finance.view` 是 false，但 `canViewProjectAmount()` 函数允许综合岗查看金额
   - 影响：可以看到所有项目的金额汇总

2. **所有项目的详细信息**
   - 问题：`project.view: "all"` 允许查看所有项目，包括其他销售创建的项目
   - 影响：可能看到不应该看到的业务数据

## 权限问题分析

### 问题1：项目金额可见性

**当前逻辑：**
- `canViewProjectAmount()` 函数（dashboard.js 第99行）允许 `admin_staff` 查看项目金额
- 但 `finance.view` 权限是 false

**建议：**
- 如果综合岗不应该看到财务数据，应该从 `canViewProjectAmount()` 中移除 `admin_staff`
- 或者，如果综合岗需要看到项目金额（用于项目管理），应该明确说明这是业务需要

### 问题2：项目查看范围

**当前逻辑：**
- `project.view: "all"` 允许查看所有项目
- 这可能过于宽泛

**建议：**
- 考虑是否需要限制综合岗只能查看：
  - 自己创建的项目
  - 自己参与的项目（作为成员）
  - 或者保持 "all" 但明确这是业务需要

## 建议的权限调整

### 方案1：严格限制（推荐）

如果综合岗不应该看到财务相关数据：

1. **移除项目金额查看权限**
   ```javascript
   // dashboard.js
   const allowed = ['admin', 'finance', 'sales', 'part_time_sales'];
   // 移除 'admin_staff'
   ```

2. **限制项目查看范围**
   ```javascript
   // config/permissions.js
   'admin_staff': {
     'project.view': 'assigned', // 改为只能查看分配的项目
     // 或者 'self' 如果只能查看自己创建的
   }
   ```

### 方案2：保持现状但明确说明

如果综合岗需要看到这些数据用于业务管理：

1. **保持当前权限**
2. **明确文档说明**：综合岗可以查看所有项目信息（包括金额）用于项目管理，但不包括财务敏感数据（回款、发票等）

## 对比其他角色

| 角色 | 项目查看 | 金额查看 | 财务数据 | KPI查看 |
|------|---------|---------|---------|---------|
| **管理员** | 所有 | ✅ | ✅ | 所有 |
| **财务** | 所有 | ✅ | ✅ | 所有 |
| **销售** | 自己创建的 | ✅ | 自己创建的 | 自己 |
| **PM** | 分配的 | ❌ | ❌ | 自己 |
| **翻译/审校** | 分配的 | ❌ | ❌ | 自己 |
| **综合岗** | **所有** | **✅** | **❌** | **自己** |

## 结论

综合岗的权限确实可能过宽：

1. ✅ **财务数据控制正确**：不能看到回款预警、回款完成率等财务数据
2. ⚠️ **项目金额可能过宽**：可以看到所有项目的金额合计
3. ⚠️ **项目查看范围可能过宽**：可以查看所有项目，包括其他销售创建的项目

建议根据实际业务需求调整权限。

