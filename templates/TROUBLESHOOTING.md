# 合同模板错误排查指南

## 常见错误类型

### 1. 未闭合的标签

**错误信息示例：**
```
错误ID: unclosed_tag
说明: Unclosed tag
标签: if
```

**原因：** `{#if}` 标签没有对应的 `{/if}` 闭合标签

**解决方法：**
- 检查所有 `{#if}` 都有对应的 `{/if}`
- 检查所有 `{#each}` 都有对应的 `{/each}`

**示例：**
```docx
{#if isTranslation}☑{/if} 笔译    {#if isInterpretation}☑{/if} 口译
```

### 2. 未定义的变量

**错误信息示例：**
```
错误ID: undefined_variable
说明: Variable not found
标签: projectNumber
```

**原因：** 模板中使用了未定义的变量

**解决方法：**
- 检查变量名是否正确（区分大小写）
- 参考 `README.md` 中的可用变量列表
- 确保变量名拼写正确

**正确示例：**
```docx
项目编号：{projectNumber}
```

**错误示例：**
```docx
项目编号：{project_number}  <!-- 错误：变量名不存在 -->
项目编号：{ProjectNumber}    <!-- 错误：大小写不匹配 -->
```

### 3. 循环语法错误

**错误信息示例：**
```
错误ID: loop_error
说明: Loop syntax error
```

**原因：** 循环语法不正确

**解决方法：**
- 确保使用 `{#each 数组名}` 和 `{/each}` 配对
- 循环内的变量使用 `{变量名}` 而不是 `{数组名.变量名}`

**正确示例：**
```docx
{#each members}
角色：{role}，姓名：{name}
{/each}
```

**错误示例：**
```docx
{#each members}
角色：{members.role}  <!-- 错误：循环内不需要数组名前缀 -->
{/each}
```

### 4. 条件判断语法错误

**错误信息示例：**
```
错误ID: condition_error
说明: Condition syntax error
```

**原因：** 条件判断语法不正确

**解决方法：**
- 使用 `{#if 变量名}` 和 `{/if}` 配对
- 布尔变量直接使用变量名，不需要 `== true`

**正确示例：**
```docx
{#if isTranslation}☑{/if} 笔译
{#if hasMembers}
有项目成员
{/if}
```

**错误示例：**
```docx
{#if isTranslation == true}  <!-- 错误：不需要 == true -->
{#if isTranslation}☑ 笔译     <!-- 错误：缺少 {/if} -->
```

### 5. 特殊字符问题

**错误信息示例：**
```
错误ID: delimiter_error
说明: Delimiter error
```

**原因：** 使用了错误的分隔符或特殊字符

**解决方法：**
- 确保使用英文半角花括号 `{}`
- 不要使用中文全角花括号 `｛｝`
- 不要使用方括号 `[]` 或其他符号

**正确示例：**
```docx
{projectNumber}
```

**错误示例：**
```docx
｛projectNumber｝  <!-- 错误：全角花括号 -->
[projectNumber]    <!-- 错误：方括号 -->
```

## 调试步骤

1. **查看详细错误信息**
   - 服务器日志会显示所有错误的详细信息
   - 每个错误都包含：类型、消息、说明、标签、错误ID、位置

2. **检查错误位置**
   - 根据错误信息中的"标签"字段，找到模板中对应的变量或标签
   - 检查该位置的语法是否正确

3. **验证变量名**
   - 对照 `README.md` 中的可用变量列表
   - 确保变量名拼写正确，大小写匹配

4. **检查标签配对**
   - 确保所有 `{#if}` 都有 `{/if}`
   - 确保所有 `{#each}` 都有 `{/each}`

5. **测试简单模板**
   - 先创建一个只包含简单变量的模板测试
   - 确认基本功能正常后，再添加条件判断和循环

## 模板检查清单

在创建或修改模板后，请检查：

- [ ] 所有变量名都在可用变量列表中
- [ ] 所有变量名大小写正确
- [ ] 所有 `{#if}` 都有对应的 `{/if}`
- [ ] 所有 `{#each}` 都有对应的 `{/each}`
- [ ] 使用英文半角花括号 `{}`
- [ ] 循环内的变量名正确（不需要数组名前缀）
- [ ] 条件判断使用布尔变量，不需要 `== true`

## 获取帮助

如果遇到无法解决的问题：

1. 复制完整的错误信息（包括所有错误详情）
2. 检查模板文件中对应的位置
3. 参考本文档的常见错误类型
4. 如果仍然无法解决，请提供错误信息和模板片段以便进一步诊断





