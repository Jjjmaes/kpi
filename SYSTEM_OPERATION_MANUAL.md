# 语家 KPI 系统 - 完整操作说明文档

## 目录

1. [系统概述](#系统概述)
2. [登录与用户管理](#登录与用户管理)
3. [客户管理](#客户管理)
4. [项目管理](#项目管理)
5. [KPI 管理](#kpi-管理)
6. [财务管理](#财务管理)
7. [邮件功能](#邮件功能)
8. [系统配置](#系统配置)
9. [评价与反馈](#评价与反馈)
10. [业务看板快捷过滤](#业务看板快捷过滤)
11. [常见问题](#常见问题)

---

## 系统概述

### 系统简介

语家 KPI 系统是一个专为翻译公司设计的绩效管理系统，支持项目全生命周期管理、自动化 KPI 计算、财务管理和邮件通知等功能。

### 主要功能模块

- **用户管理**：用户创建、角色分配、权限管理
- **客户管理**：客户信息管理、联系人管理
- **项目管理**：项目创建、成员分配、状态跟踪、附件上传
- **KPI 管理**：自动计算绩效、月度汇总、审核
- **财务管理**：发票申请、回款管理、财务统计
- **邮件通知**：项目分配邮件、附件发送

### 系统角色

| 角色 | 权限说明 |
|------|---------|
| **管理员 (admin)** | 所有权限，可管理用户、配置系统 |
| **财务 (finance)** | 查看所有项目、管理发票和回款 |
| **销售 (sales)** | 创建项目、管理自己创建的客户和项目 |
| **兼职销售 (part_time_sales)** | 创建项目、管理自己创建的客户和项目 |
| **项目经理 (pm)** | 查看分配给自己的项目、管理项目成员 |
| **翻译 (translator)** | 查看分配给自己的项目 |
| **审校 (reviewer)** | 查看分配给自己的项目 |
| **排版 (layout)** | 查看分配给自己的项目 |
| **综合岗 (admin_staff)** | 查看所有项目、管理项目 |

---

## 登录与用户管理

### 1. 系统登录

#### 操作步骤

1. 打开系统登录页面
2. 输入用户名和密码
3. 点击"登录"按钮
4. 首次登录或密码重置后，系统会提示修改密码

#### 注意事项

- 密码复杂度要求：
  - 至少 8 位
  - 包含大写字母、小写字母、数字和特殊字符
- 如果忘记密码，请联系管理员重置

### 2. 用户管理（仅管理员）

#### 2.1 创建用户

**操作步骤：**

1. 进入"用户管理"页面
2. 点击"创建用户"按钮
3. 填写用户信息：
   - **姓名** *（必填）
   - **用户名** *（必填，唯一）
   - **邮箱** *（必填，唯一）
   - **电话**（可选）
   - **角色** *（至少选择一个）
   - **专/兼职**（默认：专职）
   - **状态**（默认：激活）
4. 点击"创建"按钮

**注意事项：**

- 用户名和邮箱必须唯一
- 创建后系统会生成随机密码，管理员可以复制密码告知用户
- 用户首次登录需要修改密码

#### 2.2 编辑用户

**操作步骤：**

1. 在用户列表中找到要编辑的用户
2. 点击"编辑"按钮
3. 修改用户信息（用户名不可修改）
4. 点击"更新"按钮

**可修改字段：**

- 姓名
- 邮箱
- 电话
- 角色
- 状态（激活/禁用）
- 专/兼职

#### 2.3 重置密码

**操作步骤：**

1. 在用户列表中找到要重置密码的用户
2. 点击"重置密码"按钮
3. 系统会生成新密码并显示
4. 复制密码告知用户

#### 2.4 删除用户

**操作步骤：**

1. 在用户列表中找到要删除的用户
2. 点击"删除"按钮
3. 确认删除操作

**注意：** 删除用户实际上是软删除（设置为禁用状态），不会真正删除数据。

### 3. 个人中心

#### 3.1 修改个人信息

**操作步骤：**

1. 点击右上角用户名，选择"个人中心"
2. 在"基本信息"卡片中修改：
   - **邮箱** *（必填）
   - **电话**（可选）
3. 点击"更新信息"按钮

**注意：** 用户名和姓名只能由管理员修改。

#### 3.2 修改密码

**操作步骤：**

1. 在个人中心页面
2. 在"修改密码"卡片中填写：
   - **当前密码** *
   - **新密码** *（需符合复杂度要求）
   - **确认新密码** *
3. 点击"修改密码"按钮

---

## 客户管理

### 1. 创建客户（销售、兼职销售、管理员）

#### 操作步骤

1. 进入"客户管理"页面
2. 点击"创建客户"按钮
3. 填写客户信息：
   - **客户名称** *（必填）
   - **客户简称**（可选）
   - **联系人姓名** *（必填）
   - **联系人电话** *（必填）
   - **联系人邮箱** *（必填）
   - **联系人职位**（可选）
   - **地址**（可选）
4. 点击"创建"按钮

#### 权限说明

- **销售/兼职销售**：只能查看和编辑自己创建的客户
- **管理员/财务**：可以查看和编辑所有客户
- **其他角色**：客户信息会被脱敏处理（显示为 *****）

### 2. 编辑客户

#### 操作步骤

1. 在客户列表中找到要编辑的客户
2. 点击"编辑"按钮
3. 修改客户信息
4. 点击"更新"按钮

#### 添加联系人

在编辑客户时，可以添加多个联系人：
1. 点击"添加联系人"按钮
2. 填写联系人信息
3. 可以设置一个联系人为"主要联系人"

### 3. 查看客户详情

点击客户列表中的客户名称，可以查看：
- 客户基本信息
- 联系人列表
- 关联的项目列表

---

## 项目管理

### 1. 创建项目（销售、兼职销售、管理员）

#### 操作步骤

1. 进入"项目管理"页面
2. 点击"创建项目"按钮
3. 填写项目基本信息：

   **基本信息：**
   - **项目编号**（可选，留空自动生成）
   - **项目名称** *（必填）
   - **选择客户** *（必填）
   - **选择联系人**（可选，从客户联系人中选择）
   - **业务类型** *（笔译/口译/转录/本地化/其他）
   - **项目类型**（笔译项目：MTPE/深度编辑/审校项目/混合类型）

   **语种信息：**
   - **源语种** *（必填）
   - **目标语种** *（至少一个，可添加多个）

   **金额信息：**
   - **字数**（笔译项目）
   - **单价**（每千字或每小时）
   - **项目总金额** *（必填）
   - **含税**（勾选表示金额含税）
   - **需要发票**（勾选表示需要开具发票）

   **时间信息：**
   - **交付时间** *（必填）
   - **预计回款时间**（默认3个月后）

   **特殊要求：**
   - 术语表要求
   - NDA 要求
   - 参考文件
   - 纯翻译交付
   - 双语交付
   - 打印盖章并快递
   - 备注

4. **添加项目成员**（可选）：
   - 选择角色（项目经理/翻译/审校/排版等）
   - 选择用户
   - 对于翻译角色，需要选择翻译类型（MTPE/深度编辑）和字数占比
   - 对于排版角色，可以设置排版费用（不超过项目金额的5%）
   - 点击"添加成员"按钮

5. **上传项目附件**（可选）：
   - 点击文件选择框
   - 选择要上传的文件（可多选）
   - 文件总大小不超过 20MB
   - 附件会通过邮件发送给项目成员，不会保存到服务器

6. 点击"创建项目"按钮

#### 权限说明

- **销售/兼职销售**：只能创建项目，只能查看和编辑自己创建的项目
- **管理员**：可以创建、查看和编辑所有项目
- **项目经理**：只能查看分配给自己的项目
- **翻译/审校/排版**：只能查看分配给自己的项目

### 2. 查看项目列表

#### 筛选功能

- **按月份筛选**：选择项目创建月份
- **按状态筛选**：待开始/待安排/进行中/已完成/已取消
- **按业务类型筛选**：笔译/口译/转录/本地化/其他
- **按角色筛选**：查看特定角色的项目
- **按客户筛选**：选择特定客户的项目
- **回款预警快捷筛选**：在业务看板点击“回款预警/近7天回款预警”卡片会跳转至项目列表，并仅显示预警项目，便于导出或后续操作
- **金额可见性**：仅管理员/财务/销售/兼职销售可见金额，综合岗不再显示项目金额

#### 项目状态说明

- **待开始**：项目已创建，未开始
- **待安排**：项目已创建，等待安排成员
- **进行中**：项目已开始，正在执行
- **已完成**：项目已完成
- **已取消**：项目已取消

### 3. 查看项目详情

#### 操作步骤

1. 在项目列表中点击"查看"按钮
2. 查看项目详细信息：
   - 基本信息
   - 客户信息
   - 语种信息
   - 金额信息
   - 时间信息
   - 项目成员
   - 特殊要求
   - 回款记录
   - 发票记录
   - 导出合同：点击“导出合同”生成 Word（管理员/项目创建人/项目经理可用，联系人遵循脱敏规则）

#### 权限说明

- **销售/兼职销售**：可以看到完整的客户联系信息
- **其他角色**：客户联系信息会被脱敏处理（显示为 *****）

### 4. 编辑项目

#### 操作步骤

1. 在项目详情页面点击"编辑"按钮
2. 修改项目信息
3. 点击"更新"按钮

#### 可编辑内容

- 项目基本信息
- 金额信息
- 时间信息
- 特殊要求
- 项目成员（添加/删除）

**注意：** 只有管理员和项目创建人（销售/兼职销售）可以编辑项目。

### 5. 项目成员管理

#### 5.1 添加成员

**在创建项目时：**
- 在项目创建表单中添加成员

**在编辑项目时：**
1. 打开项目编辑表单
2. 在"项目成员"区域点击"添加成员"按钮
3. 选择角色和用户
4. 填写相关信息（如翻译类型、字数占比等）
5. 点击"添加"按钮

#### 5.2 删除成员

**操作步骤：**

1. 在项目编辑表单的"项目成员"区域
2. 找到要删除的成员
3. 点击"删除"按钮
4. 确认删除

**注意：** 只有管理员、项目经理和项目创建人可以管理成员。

### 6. 项目状态操作

#### 6.1 开始项目

**操作步骤：**

1. 在项目详情页面
2. 点击"开始项目"按钮
3. 项目状态变为"进行中"

**条件：** 项目必须已添加成员才能开始。

#### 6.2 完成项目

**操作步骤：**

1. 在项目详情页面
2. 点击"完成项目"按钮
3. 项目状态变为"已完成"

#### 6.3 标记返修

**操作步骤：**

1. 在项目详情页面
2. 点击"标记返修"按钮
3. 填写返修原因
4. 确认标记

#### 6.4 标记延期

**操作步骤：**

1. 在项目详情页面
2. 点击"标记延期"按钮
3. 填写延期原因和新的交付时间
4. 确认标记

#### 6.5 标记客诉

**操作步骤：**

1. 在项目详情页面
2. 点击"标记客诉"按钮
3. 填写客诉原因
4. 确认标记

### 7. 导出报价单

#### 操作步骤

1. 在项目详情页面
2. 点击"导出报价单"按钮
3. 系统会生成 Excel 格式的报价单并下载

**权限说明：**

- 项目创建人（销售/兼职销售）可以导出
- 管理员和财务可以导出
- 如果项目创建人同时是项目经理，也可以导出

---

## KPI 管理

### 1. 生成月度 KPI（管理员、财务）

#### 操作步骤

1. 进入"KPI 管理"页面
2. 选择要生成的月份
3. 点击"生成月度 KPI"按钮
4. 系统会自动计算所有用户的 KPI

#### KPI 计算规则

- **翻译/审校**：根据项目金额、字数、系数计算
- **项目经理**：根据项目金额和系数计算
- **销售**：根据项目金额和系数计算
- **综合岗**：根据项目金额和系数计算

### 2. 查看 KPI 记录

#### 2.1 查看个人 KPI

**操作步骤：**

1. 进入"KPI 管理"页面
2. 选择月份和角色（可选）
3. 查看自己的 KPI 记录

**显示内容：**

- 项目名称
- 角色
- 项目金额
- KPI 金额
- 月份

#### 2.2 查看所有用户 KPI（管理员、财务）

**操作步骤：**

1. 进入"KPI 管理"页面
2. 选择用户、月份和角色（可选）
3. 查看 KPI 记录

### 3. KPI 审核（管理员、财务）

#### 操作步骤

1. 在 KPI 记录列表中找到要审核的记录
2. 点击"审核"按钮
3. 选择审核结果：
   - **通过**：KPI 生效
   - **拒绝**：需要填写拒绝原因
4. 点击"确认"按钮

### 4. 导出 KPI

#### 4.1 导出月度 KPI

**操作步骤：**

1. 进入"KPI 管理"页面
2. 选择月份
3. 点击"导出月度 KPI"按钮
4. 系统会生成 Excel 文件并下载

#### 4.2 导出用户 KPI

**操作步骤：**

1. 在 KPI 记录列表中选择用户
2. 点击"导出用户 KPI"按钮
3. 系统会生成该用户的所有 KPI 记录 Excel 文件

---

## 财务管理

### 1. 回款管理

#### 1.1 添加回款记录

**操作步骤：**

1. 进入"财务管理"页面
2. 在"回款记录"区域点击"添加回款"按钮
3. 选择项目
4. 填写回款信息：
   - **回款金额** *（必填）
   - **回款日期** *（必填）
   - **支付方式**（银行转账/现金/支付宝/微信等）
   - **收款人**（仅当方式为现金/支付宝/微信时必填；需从项目成员中选择财务/销售/兼职销售）
   - **备注/凭证号**（可选）
5. 点击"添加"按钮

**权限说明：**

- 管理员和财务可以添加回款记录
- 现金/支付宝/微信类收款需填写收款人，且必须是该项目成员中的财务/销售/兼职销售
- 回款金额不能超过项目未回款金额

#### 1.2 查看回款记录

**操作步骤：**

1. 在"回款记录"区域查看所有回款记录
2. 可以按月份、客户、销售筛选
3. 查看回款详情：
   - 项目信息
   - 回款金额
   - 回款日期
   - 回款状态

### 2. 发票管理

#### 2.1 申请开票（销售、兼职销售）

**操作步骤：**

1. 进入"财务管理"页面
2. 在"发票管理"区域点击"申请开票"按钮
3. 选择要申请开票的项目（可多选）
4. 填写申请信息：
   - **申请金额** *（必填）
   - **申请原因**（可选）
5. 点击"提交申请"按钮

**条件：**

- 项目状态必须为"进行中"或"已完成"
- 项目不能已取消
- 不能有待审批或已批准的申请

#### 2.2 查看申请状态

**操作步骤：**

1. 在项目列表中，已申请开票的项目会显示状态标签：
   - **待审批**：申请已提交，等待审批
   - **已开票**：申请已批准，发票已创建
   - **已拒绝**：申请被拒绝
2. 点击"查看申请"按钮查看详细信息

#### 2.3 审批发票申请（财务、管理员）

**操作步骤：**

1. 进入"财务管理"页面
2. 在"发票申请"区域查看待审批的申请
3. 点击"批准"或"拒绝"按钮
4. 如果批准，需要填写发票信息：
   - **发票号** *（必填）
   - **开票日期** *（必填）
   - **发票类型**（普通发票/专用发票）
   - **备注**（可选）
5. 点击"确认"按钮

#### 2.4 创建发票（财务、管理员）

**操作步骤：**

1. 进入"财务管理"页面
2. 在"发票管理"区域点击"创建发票"按钮
3. 选择项目
4. 填写发票信息：
   - **发票号** *（必填）
   - **发票金额** *（必填，不能超过项目可开票金额）
   - **开票日期** *（必填）
   - **发票类型**（普通发票/专用发票）
   - **备注**（可选）
5. 点击"创建"按钮

### 3. 财务统计

#### 3.1 查看回款统计

**操作步骤：**

1. 进入"财务管理"页面
2. 在"回款统计"区域查看：
   - 月度回款总额
   - 客户回款统计
   - 销售回款统计

#### 3.2 查看发票统计

**操作步骤：**

1. 在"发票管理"区域查看：
   - 月度开票总额
   - 项目开票情况
   - 发票类型统计

---

## 邮件功能

### 1. 邮件配置

#### 环境变量配置

在 `.env` 文件中配置：

```env
RESEND_API_KEY=re_xxxxxxxxxxxxx
RESEND_FROM_EMAIL=noreply@yourdomain.com
RESEND_FROM_NAME=语家 KPI 系统
APP_URL=http://localhost:3000
EMAIL_ENABLED=true
```

#### 获取 Resend API Key

1. 访问 https://resend.com
2. 注册/登录账号
3. 进入 Dashboard → API Keys
4. 创建新的 API Key
5. 复制 Key 到环境变量

### 2. 项目分配邮件

#### 自动发送场景

- **创建项目时添加成员**：系统会自动发送邮件给所有被分配的项目成员
- **单独添加项目成员**：系统会自动发送邮件给新添加的成员

#### 邮件内容

- 项目名称和编号
- 分配的角色
- 交付时间
- 源语种和目标语种
- 分配人信息
- 项目附件（如果有）
- 查看项目详情链接

#### 测试邮件功能

1. 确保邮件服务已正确配置
2. 创建项目并添加成员
3. 检查成员邮箱是否收到邮件
4. 查看服务器日志确认发送状态

### 3. 附件发送

#### 功能说明

- 在创建项目时可以上传附件
- 附件会通过邮件发送给所有项目成员
- 附件不会保存到服务器

#### 使用步骤

1. 在创建项目表单中
2. 在"项目附件"区域选择文件
3. 可以上传多个文件，总大小不超过 20MB
4. 提交项目后，附件会随邮件发送

---

## 系统配置

### 1. KPI 系数配置（管理员）

#### 操作步骤

1. 进入"系统配置"页面
2. 在"KPI 系数配置"区域
3. 配置各项系数：
   - **翻译系数**（MTPE/深度编辑）
   - **审校系数**
   - **项目经理系数**
   - **销售系数**
   - **综合岗系数**
4. 点击"保存"按钮

#### 注意事项

- 系数变更会影响新创建的项目
- 已创建的项目使用锁定系数，不受影响
- 系统会记录配置变更历史

### 2. 语言管理（管理员）

#### 添加语言

1. 进入"系统配置"页面
2. 在"语言管理"区域点击"添加语言"
3. 填写语言信息：
   - **语言名称** *（必填）
   - **语言代码**（可选，如 en, zh）
   - **本地名称**（可选）
   - **状态**（激活/禁用）
4. 点击"创建"按钮

#### 编辑语言

1. 在语言列表中找到要编辑的语言
2. 点击"编辑"按钮
3. 修改语言信息
4. 点击"更新"按钮

### 3. 角色管理（管理员）

#### 查看角色

1. 进入"系统配置"页面
2. 在"角色管理"区域查看所有角色
3. 查看角色权限配置

#### 角色权限说明

- **project.view**：项目查看权限（all/assigned/sales/self）
- **project.edit**：项目编辑权限
- **project.create**：项目创建权限
- **kpi.view**：KPI 查看权限（all/self）
- **finance.view**：财务查看权限
- **customer.view**：客户查看权限
- **user.manage**：用户管理权限


---

## 评价与反馈

### 1. 评价类型与权限

- 项目经理 → 销售：PM 可针对项目的销售提交评价
- 翻译/审校/排版 → 项目经理：执行角色可评价该项目的 PM
- 评价仅用于反馈，不影响 KPI 计算
- 支持匿名提交（如前端提供匿名选项）

### 2. 提交评价

1. 在项目详情页点击评价入口（针对销售或项目经理）
2. 选择评价对象并填写评分、文字反馈，可选匿名
3. 提交后记录在项目评价列表

### 3. 查看评价

- 在项目详情页查看该项目的评价列表
- 在个人中心/用户详情查看“我的评价统计”（平均分与近期评价）

### 4. 时间限制

- 仅已完成的项目可评价
- 默认完成后 30 天内允许评价，超期不可提交

---

## 业务看板快捷过滤

- “回款预警”“近7天回款预警”卡片：点击后直接跳转到项目列表，并只显示预警项目，便于导出和后续操作（不再进入财务模块）
- “回款即将到期”卡片：仍进入财务回款列表
- 金额显示遵循角色权限：管理员/财务可见全部；销售仅可见自己创建项目的金额/回款；综合岗不显示金额

---

## 常见问题

### 1. 登录问题

**Q: 忘记密码怎么办？**

A: 请联系管理员重置密码。

**Q: 首次登录提示修改密码？**

A: 这是正常的安全设置，请按照密码复杂度要求设置新密码。

### 2. 权限问题

**Q: 为什么看不到某些项目？**

A: 根据角色权限，您只能查看：
- 自己创建的项目（销售/兼职销售）
- 分配给自己的项目（项目经理/翻译/审校/排版）
- 所有项目（管理员/财务）

**Q: 为什么不能编辑项目？**

A: 只有管理员和项目创建人可以编辑项目。

### 3. 项目问题

**Q: 如何添加项目成员？**

A: 在创建项目时添加，或在项目编辑页面添加。

**Q: 项目附件在哪里？**

A: 附件通过邮件发送给项目成员，不会保存在系统中。

**Q: 如何导出报价单？**

A: 在项目详情页面点击"导出报价单"按钮。

### 4. KPI 问题

**Q: KPI 如何计算？**

A: 系统根据项目金额、字数、系数自动计算。

**Q: 如何生成月度 KPI？**

A: 管理员或财务在 KPI 管理页面选择月份后点击"生成月度 KPI"。

### 5. 财务问题

**Q: 如何申请开票？**

A: 销售/兼职销售在财务管理页面点击"申请开票"，选择项目并填写信息。

**Q: 如何添加回款记录？**

A: 管理员或财务在财务管理页面点击"添加回款"，选择项目并填写回款信息。

### 6. 邮件问题

**Q: 为什么没有收到项目分配邮件？**

A: 检查以下几点：
1. 邮件服务是否已配置（RESEND_API_KEY, RESEND_FROM_EMAIL）
2. 用户邮箱是否正确
3. 查看服务器日志确认发送状态
4. 检查垃圾邮件文件夹

**Q: 附件大小限制是多少？**

A: 单个文件不超过 20MB，所有附件总大小不超过 20MB。

### 7. 系统配置问题

**Q: 如何修改 KPI 系数？**

A: 管理员在系统配置页面修改，注意已创建的项目不受影响。

**Q: 如何添加新语言？**

A: 管理员在系统配置页面的语言管理区域添加。

---

## 测试检查清单

### 功能测试

- [ ] 用户登录和密码修改
- [ ] 用户创建、编辑、删除
- [ ] 客户创建、编辑、联系人管理
- [ ] 项目创建（包含附件上传）
- [ ] 项目成员添加和删除
- [ ] 项目状态操作（开始、完成、返修、延期、客诉）
- [ ] 报价单导出
- [ ] KPI 生成和查看
- [ ] KPI 审核
- [ ] 回款记录添加
- [ ] 发票申请和审批
- [ ] 发票创建
- [ ] 邮件发送（项目分配、附件）

### 权限测试

- [ ] 销售只能查看自己创建的项目和客户
- [ ] 项目经理只能查看分配给自己的项目
- [ ] 翻译/审校/排版只能查看分配给自己的项目
- [ ] 财务可以查看所有项目和财务信息
- [ ] 管理员拥有所有权限

### 数据脱敏测试

- [ ] 非销售角色查看客户信息时，联系方式被脱敏
- [ ] 非项目创建人查看项目时，客户联系信息被脱敏

### 邮件功能测试

- [ ] 创建项目时添加成员，邮件自动发送
- [ ] 单独添加成员时，邮件自动发送
- [ ] 附件随邮件发送
- [ ] 邮件内容正确显示

### 性能测试

- [ ] 大量项目列表加载
- [ ] 大量用户列表加载
- [ ] 文件上传和邮件发送性能

---

## 技术支持

如有问题，请：

1. 查看系统日志
2. 检查浏览器控制台错误
3. 查看服务器日志
4. 联系系统管理员

---

**文档版本：** 1.0  
**最后更新：** 2025-12-20

