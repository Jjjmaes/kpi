# 功能更新说明

## 新增功能

### 1. 客户管理模块

#### 功能特性
- ✅ 创建客户：支持完整的客户信息录入
- ✅ 编辑客户：修改客户信息
- ✅ 删除客户：软删除（仅管理员）
- ✅ 搜索客户：支持按名称、简称、联系人搜索
- ✅ 客户列表：显示所有客户信息

#### 客户信息字段
- 客户名称（必填）
- 客户简称
- 联系人
- 联系电话
- 邮箱
- 地址
- 备注

#### 权限控制
- 销售、管理员：可创建、编辑客户
- 管理员：可删除客户
- 销售、管理员、财务：可查看客户列表

### 2. 项目创建功能增强

#### 新增字段
- ✅ **项目编号**：自动生成（格式：PRJ2024010001）或手动输入
- ✅ **业务类型**：笔译、口译、转录、本地化、其他
- ✅ **字数**：笔译项目专用
- ✅ **单价**：每千字价格（笔译项目）
- ✅ **总价**：自动计算（字数×单价/1000）或手动输入

#### 功能改进
- ✅ **客户选择**：从客户表下拉选择，不再手动输入
- ✅ **自动计算**：笔译项目根据字数和单价自动计算总价
- ✅ **智能表单**：根据业务类型显示/隐藏相关字段

### 3. 项目列表和详情增强

#### 列表显示
- 显示项目编号
- 显示业务类型
- 显示客户信息（关联显示）

#### 详情显示
- 完整的项目信息
- 客户详细信息（联系人、电话、邮箱）
- 字数、单价信息（笔译项目）
- 项目编号

## 使用流程

### 客户管理流程
1. 进入"客户管理"页面
2. 点击"创建新客户"
3. 填写客户信息（至少填写客户名称）
4. 保存后可在创建项目时选择

### 项目创建流程（新）
1. 进入"项目管理"页面
2. 点击"创建新项目"
3. 填写项目信息：
   - 项目编号（可选，留空自动生成）
   - 项目名称（必填）
   - 选择客户（从下拉列表选择，或创建新客户）
   - 选择业务类型
   - 如果是笔译项目：
     - 填写字数
     - 填写单价（每千字）
     - 总价自动计算
   - 如果是其他类型：
     - 手动输入总价
   - 选择交付时间
4. 保存项目

### 项目编号规则
- 格式：`PRJ + 年份(4位) + 月份(2位) + 序号(4位)`
- 示例：`PRJ2024010001`（2024年1月第1个项目）
- 自动生成：如果未手动输入，系统自动生成
- 唯一性：项目编号必须唯一

### 业务类型说明
- **笔译**：需要填写字数和单价，总价自动计算
- **口译**：手动输入总价
- **转录**：手动输入总价
- **本地化**：手动输入总价
- **其他**：手动输入总价

## API变更

### 新增API端点

#### 客户管理
- `GET /api/customers` - 获取客户列表（支持搜索）
- `GET /api/customers/:id` - 获取客户详情
- `POST /api/customers` - 创建客户
- `PUT /api/customers/:id` - 更新客户
- `DELETE /api/customers/:id` - 删除客户（软删除）

### 项目创建API变更

#### 请求参数（新增）
```json
{
  "projectNumber": "PRJ2024010001",  // 可选，留空自动生成
  "projectName": "项目名称",
  "customerId": "客户ID",            // 必填，从客户表选择
  "businessType": "translation",     // 业务类型
  "wordCount": 10000,                // 字数（笔译项目）
  "unitPrice": 150,                  // 单价（每千字）
  "projectAmount": 1500,              // 总价（自动计算或手动输入）
  "deadline": "2024-02-01"
}
```

## 数据库变更

### 新增模型：Customer
- 客户基本信息
- 联系人信息
- 创建人、创建时间等

### Project模型新增字段
- `projectNumber`: String（项目编号）
- `customerId`: ObjectId（客户ID，关联Customer）
- `businessType`: String（业务类型）
- `wordCount`: Number（字数）
- `unitPrice`: Number（单价）

## 注意事项

1. **客户关联**：创建项目时必须选择已存在的客户
2. **项目编号**：建议使用自动生成，确保唯一性
3. **总价计算**：笔译项目会自动计算，其他类型需手动输入
4. **数据兼容**：旧项目保留`clientName`字段，新项目使用`customerId`关联

## 后续优化建议

1. 客户导入功能（Excel导入）
2. 项目模板功能
3. 客户统计分析
4. 项目编号自定义规则配置
5. 业务类型扩展配置



























