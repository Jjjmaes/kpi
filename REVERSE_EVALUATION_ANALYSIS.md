# 反向评价功能分析与实现方案

## 一、功能需求分析

### 1.1 评价场景

#### 场景1：项目经理评价销售
**评价对象**：项目创建人（销售/兼职销售）  
**评价人**：项目经理（PM）  
**评价时机**：项目完成后  
**评价内容**：
- 项目信息完整性（客户信息、需求描述、特殊要求等）
- 客户沟通质量（响应速度、问题解决能力）
- 项目交接质量（文件准备、需求传达）
- 整体满意度

#### 场景2：执行人员评价项目经理
**评价对象**：项目经理（PM）  
**评价人**：翻译、审校、排版  
**评价时机**：项目完成后  
**评价内容**：
- 项目管理能力（进度控制、资源分配）
- 沟通协调能力（信息传达、问题反馈）
- 技术支持（术语表、参考文件提供）
- 整体满意度

### 1.2 业务价值

✅ **优点：**
1. **持续改进**：收集反馈，优化工作流程
2. **团队协作**：促进跨角色沟通和理解
3. **绩效考核**：作为KPI之外的补充评价维度
4. **问题识别**：及时发现和解决协作问题
5. **数据积累**：长期数据可用于人员评估

⚠️ **潜在问题：**
1. **主观性**：评价可能带有个人情绪
2. **匿名性**：是否匿名评价？
3. **强制性**：是否强制评价？不评价是否影响项目完成？
4. **KPI影响**：是否影响KPI计算？还是仅用于反馈？

## 二、是否需要实现？

### 2.1 建议实现，但需要明确定位

**推荐实现，原因：**
1. ✅ 提升团队协作质量
2. ✅ 数据驱动的改进
3. ✅ 补充KPI的定性评价
4. ✅ 符合现代管理理念

**但需要明确：**
- **定位**：作为**反馈和改进工具**，而非KPI计算依据
- **可选性**：评价应该是**可选的**，不影响项目流程
- **时间限制**：项目完成后一定时间内（如7-30天）可评价
- **匿名性**：建议**匿名评价**，确保真实反馈

## 三、技术实现方案

### 3.1 数据模型设计

#### 方案A：独立评价模型（推荐）

```javascript
// models/ProjectEvaluation.js
const evaluationSchema = new mongoose.Schema({
  projectId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Project',
    required: true
  },
  // 评价人
  evaluatorId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  evaluatorRole: {
    type: String,
    required: true // pm, translator, reviewer, layout
  },
  // 被评价人
  evaluatedUserId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  evaluatedRole: {
    type: String,
    required: true // sales, pm
  },
  // 评价类型
  evaluationType: {
    type: String,
    enum: ['pm_to_sales', 'executor_to_pm'],
    required: true
  },
  // 评分（1-5分）
  scores: {
    informationCompleteness: { type: Number, min: 1, max: 5 }, // 信息完整性
    communicationQuality: { type: Number, min: 1, max: 5 }, // 沟通质量
    problemSolving: { type: Number, min: 1, max: 5 }, // 问题解决
    overallSatisfaction: { type: Number, min: 1, max: 5 } // 整体满意度
  },
  // 评语
  comments: {
    type: String,
    maxlength: 500
  },
  // 是否匿名
  isAnonymous: {
    type: Boolean,
    default: true
  },
  // 评价时间
  evaluatedAt: {
    type: Date,
    default: Date.now
  }
});
```

**优点：**
- 结构清晰，易于查询和统计
- 支持多种评价类型扩展
- 支持匿名评价

#### 方案B：嵌入项目模型（不推荐）

在Project模型中添加evaluations数组，但会导致：
- 项目文档过大
- 查询性能问题
- 难以统计和导出

### 3.2 评价规则

#### 规则1：评价权限
- **PM评价销售**：
  - 条件：项目已完成，且PM是项目成员
  - 被评价人：项目创建人（销售）
  - 时间限制：项目完成后30天内

- **执行人员评价PM**：
  - 条件：项目已完成，且评价人是项目成员（翻译/审校/排版）
  - 被评价人：项目中的PM成员
  - 时间限制：项目完成后30天内

#### 规则2：评价限制
- 每个项目，每个评价人只能评价一次
- 不能评价自己
- 项目完成后才能评价
- 超过时间限制后不能评价

#### 规则3：匿名性
- 默认匿名评价
- 管理员可以查看评价人信息（用于处理恶意评价）

### 3.3 API设计

```
POST /api/projects/:projectId/evaluations
  - 创建评价
  - 权限：项目成员（根据评价类型）

GET /api/projects/:projectId/evaluations
  - 获取项目的所有评价
  - 权限：项目成员、管理员

GET /api/users/:userId/evaluations
  - 获取用户收到的评价统计
  - 权限：本人、管理员

GET /api/evaluations/stats
  - 获取评价统计（平均分、评价数量等）
  - 权限：管理员
```

### 3.4 前端界面

#### 界面1：项目详情页 - 评价入口
- 项目完成后，显示"评价"按钮
- 根据用户角色显示不同的评价选项
- 显示评价状态（已评价/未评价/已过期）

#### 界面2：评价表单
- 评分（1-5星或1-5分）
- 评语（可选）
- 匿名选项（默认勾选）
- 提交按钮

#### 界面3：评价统计页面（管理员）
- 用户评价统计
- 平均分趋势
- 评价详情列表

## 四、实现优先级

### P0（核心功能）
1. ✅ 数据模型创建
2. ✅ 评价创建API
3. ✅ 评价查询API
4. ✅ 前端评价表单

### P1（增强功能）
1. 评价统计和报表
2. 评价提醒（项目完成后提醒评价）
3. 评价导出功能

### P2（可选功能）
1. 评价模板（预设评价维度）
2. 评价历史对比
3. 评价趋势分析

## 五、与KPI的关系

### 建议：不影响KPI计算

**原因：**
1. KPI应该基于客观数据（项目金额、完成系数等）
2. 评价是主观反馈，不应影响绩效计算
3. 保持KPI系统的公正性和可追溯性

**但可以：**
- 作为KPI审核的参考信息
- 用于人员评估和晋升参考
- 用于团队改进和培训

## 六、实施建议

### 6.1 分阶段实施

**第一阶段：基础功能**
- 实现PM评价销售
- 实现执行人员评价PM
- 基础统计功能

**第二阶段：增强功能**
- 评价统计报表
- 评价提醒
- 评价导出

**第三阶段：高级功能**
- 评价分析
- 趋势对比
- 改进建议

### 6.2 注意事项

1. **用户接受度**：需要培训和引导，避免抵触情绪
2. **数据隐私**：确保匿名评价的真实匿名性
3. **评价质量**：提供评价指南，避免无效评价
4. **系统性能**：大量评价数据时的查询优化

## 七、替代方案

如果暂时不实现完整评价系统，可以考虑：

### 方案1：简化版评价
- 只评价整体满意度（1-5分）
- 只允许一条评语
- 不区分评价维度

### 方案2：项目备注
- 在项目完成时，允许PM添加"项目备注"
- 允许执行人员添加"工作反馈"
- 作为非结构化反馈

### 方案3：定期调研
- 定期（如每月）发送评价问卷
- 不绑定具体项目
- 通过外部工具（如问卷星）收集

## 八、结论

**建议实现反向评价功能**，但需要：

1. ✅ **明确定位**：作为反馈和改进工具，不影响KPI
2. ✅ **可选性**：评价是可选的，不强制
3. ✅ **匿名性**：默认匿名，保护评价人
4. ✅ **时间限制**：项目完成后30天内可评价
5. ✅ **分阶段实施**：先实现基础功能，再逐步增强

**预期效果：**
- 提升团队协作质量
- 数据驱动的持续改进
- 补充KPI的定性评价维度
- 增强团队沟通和理解


